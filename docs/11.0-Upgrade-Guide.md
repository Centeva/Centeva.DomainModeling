# Upgrading to 11.0

## Breaking Changes

### .NET Supported Versions

The minimum supported .NET version is now .NET 8.0.

### Separate Packages for Domain Event Dispatching

There are now two separate implementations of domain event dispatching so that
you can choose between the commercially-licensed (for newer versions)
[MediatR](https://mediatr.io/) library and the open-source
[Mediator](https://github.com/martinothamar/Mediator) library.

* Centeva.DomainModeling.MediatR
* Centeva.DomainModeling.Mediator

You will need to:

* Install one of the packages above to reference your desired domain event
  dispatcher implementation.  
* Update your Dependency Injection configuration to register that dispatcher.
* Update your code to reference the new namespace, especially in places you
  inherit from `BaseDomainEvent`. (Add `using Centeva.DomainModeling.Mediator`
  or `using Centeva.DomainModeling.MediatR`.)

If you want to switch to using the Mediator library, here's an example of
configuring to use it in `Program.cs`:

```csharp
using Centeva.DomainModeling.Mediator;

// ... other setup code

builder.Services
    .AddMediator()
    .AddSingleton<IDomainEventDispatcher, MediatorDomainEventDispatcher>();
```

### Removed DbContext Extensions

The previously obsoleted (in 10.2.0) DbContext.GetEntitiesWithEvents() extension
method has been removed.  Use the `DispatchDomainEventsInterceptor` as
described below.

## New Features

### EF Core Interceptor for Domain Event Dispatching (since 10.2.0)

The `DispatchDomainEventsInterceptor` is an EF Core interceptor that dispatches
domain events after a successful save operation.  This allows you to keep your
domain events and their handlers separate from your application code, and
ensures that they are dispatched in a consistent manner.

To use the interceptor, add it to your DbContext options:

```csharp
builder.Services.AddSingleton<DispatchDomainEventsInterceptor>();
builder.Services.AddDbContext<ApplicationDbContext>((sp, options) =>
{
    options.AddInterceptors(sp.GetRequiredService<DispatchDomainEventsInterceptor>());
    options.UseSqlServer(connectionString);
    // ... other options
});
```
