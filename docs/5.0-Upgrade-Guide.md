# Upgrading to 5.0

## Breaking Changes

* `BaseEntity` now implements the `IEntityWithEvents` interface which defines
  the domain event functionality for entities.  This allows easier selection and
  dispatching when entities have varying types for primary keys.
* `IDomainEventDispatcher.DispatchAndClearEvents` now takes
  `IEnumerable<IEntityWithEvents>` as its parameter.

## Repository

To dispatch domain events from within your DbContext, you can employ the
following:

```csharp
public override async Task<int> SaveChangesAsync(CancellationToken cancellationToken = default)
{
    var result = await base.SaveChangesAsync(cancellationToken).ConfigureAwait(false);

    var entitiesWithEvents = ChangeTracker
        .Entries()
        .Select(e => e.Entity as IEntityWithEvents)
        .Where(e => e is not null && e.DomainEvents.Any())
        .Select(e => e!)
        .ToList();

    await _domainEventDispatcher.DispatchAndClearEvents(entitiesWithEvents);

    return result;
}
```
